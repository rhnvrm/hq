# hq Walkthrough

> **Note**: This file is auto-generated by `scripts/generate_walkthrough.sh`.
> Do not edit manually - run the script to regenerate.

hq is a lightweight command-line HUML processor with jq-compatible syntax.
It reads JSON, YAML, or HUML input and outputs proper HUML format by default.

## Table of Contents

- [Installation](#installation)
- [Basic Usage](#basic-usage)
- [HUML Input Examples](#huml-input-examples)
- [Identity and Field Access](#identity-and-field-access)
- [Array Operations](#array-operations)
- [Pipe and Filters](#pipe-and-filters)
- [Operators](#operators)
- [Built-in Functions](#built-in-functions)
- [Variables and Binding](#variables-and-binding)
- [Reduce](#reduce)
- [Dynamic Index Access](#dynamic-index-access)
- [Conditionals](#conditionals)
- [Error Handling](#error-handling)
- [String Interpolation](#string-interpolation)
- [Regex](#regex)
- [Recursive Descent](#recursive-descent)
- [Path Operations](#path-operations)
- [Assignment Operators](#assignment-operators)
- [Object Transforms](#object-transforms)
- [Output Formats](#output-formats)
- [Real-World Examples](#real-world-examples)

## Installation

```bash
# Build from source
go build -o hq ./cmd/hq/

# Or install
go install github.com/rhnvrm/hq/cmd/hq@latest
```

## Basic Usage

```bash
# Show help
hq --help

# Process JSON input
echo '{"name": "Alice"}' | hq '.'

# Process with null input (for calculations)
hq -n '1 + 2 + 3'

# Output as JSON instead of HUML
echo '{"name": "Alice"}' | hq -o json '.'
```

## HUML Input Examples

hq natively supports HUML (Human-Oriented Markup Language) input.
HUML uses `::` to mark complex types (objects and arrays).

### Basic HUML Structure

Nested objects use `::` suffix:

```bash
$ cat config.huml
server::
  host: "localhost"
  port: 8080

$ hq '.server.host' config.huml
%HUML v0.2.0
"localhost"
```

### Inline Lists

Lists can be written inline with commas:

```bash
$ cat ports.huml
ports:: 80, 443, 8080

$ hq '.ports[]' ports.huml
%HUML v0.2.0
80

%HUML v0.2.0
443

%HUML v0.2.0
8080
```

### Inline Dicts

Dicts can also be inline:

```bash
$ cat point.huml
point:: x: 10, y: 20, z: 30

$ hq '.point | .x + .y + .z' point.huml
%HUML v0.2.0
60
```

### Multi-line Lists

Lists with `-` prefix:

```bash
$ cat tags.huml
tags::
  - "web"
  - "api"
  - "v2"

$ hq '.tags[]' tags.huml
%HUML v0.2.0
"web"

%HUML v0.2.0
"api"

%HUML v0.2.0
"v2"
```

### List of Objects

Use `- ::` for list items that are objects:

```bash
$ cat users.huml
users::
  - ::
    name: "Alice"
    role: "admin"
  - ::
    name: "Bob"
    role: "user"

$ hq '.users[].name' users.huml
%HUML v0.2.0
"Alice"

%HUML v0.2.0
"Bob"
```

### Filtering HUML Data

```bash
$ cat users.huml
users::
  - ::
    name: "Alice"
    active: true
  - ::
    name: "Bob"
    active: false
  - ::
    name: "Carol"
    active: true

$ hq '.users[] | select(.active) | .name' users.huml
%HUML v0.2.0
"Alice"

%HUML v0.2.0
"Carol"
```

### Deeply Nested HUML

```bash
$ cat app.huml
app::
  database::
    primary::
      host: "db1.example.com"
      port: 5432
    replica::
      host: "db2.example.com"
      port: 5432

$ hq '.app.database | keys' app.huml
%HUML v0.2.0
- "primary"
- "replica"
```

### Mixed Inline and Multi-line

```bash
$ cat server.huml
server::
  host: "localhost"
  ports:: 80, 443
  features::
    - "ssl"
    - "http2"

$ hq '.server.ports[]' server.huml
%HUML v0.2.0
80

%HUML v0.2.0
443
```

---

The following examples use JSON input for brevity, but all expressions work with HUML input too.

## Identity and Field Access

The identity operator `.` returns the input unchanged.
Field access uses `.fieldname` syntax.

### Identity

```bash
$ echo '{"name": "Alice", "age": 30}' | hq '.'
%HUML v0.2.0
age: 30
name: "Alice"
```

### Field Access

```bash
$ echo '{"name": "Alice", "age": 30}' | hq '.name'
%HUML v0.2.0
"Alice"
```

```bash
$ echo '{"name": "Alice", "age": 30}' | hq '.age'
%HUML v0.2.0
30
```

### Bracket Notation

Use bracket notation for keys with special characters:

```bash
$ echo '{"first name": "Alice"}' | hq '.["first name"]'
%HUML v0.2.0
"Alice"
```

## Array Operations

### Indexing

```bash
$ echo '["a", "b", "c", "d", "e"]' | hq '.[0]'
%HUML v0.2.0
"a"
```

```bash
$ echo '["a", "b", "c", "d", "e"]' | hq '.[2]'
%HUML v0.2.0
"c"
```

```bash
$ echo '["a", "b", "c", "d", "e"]' | hq '.[-1]'
%HUML v0.2.0
"e"
```

### Slicing

```bash
$ echo '["a", "b", "c", "d", "e"]' | hq '.[1:4]'
%HUML v0.2.0
- "b"
- "c"
- "d"
```

```bash
$ echo '["a", "b", "c", "d", "e"]' | hq '.[:3]'
%HUML v0.2.0
- "a"
- "b"
- "c"
```

```bash
$ echo '["a", "b", "c", "d", "e"]' | hq '.[-2:]'
%HUML v0.2.0
- "d"
- "e"
```

### Iterator

The iterator `.[]\ expands arrays into multiple outputs:

```bash
$ echo '[1, 2, 3]' | hq '.[]'
%HUML v0.2.0
1

%HUML v0.2.0
2

%HUML v0.2.0
3
```

For objects, it returns all values:

```bash
$ echo '{"a": 1, "b": 2, "c": 3}' | hq '.[]'
%HUML v0.2.0
1

%HUML v0.2.0
2

%HUML v0.2.0
3
```

## Pipe and Filters

### Pipe Operator

Chain operations with `|`:

```bash
$ echo '[1, 2, 3, 4, 5]' | hq '.[] | . * 2'
%HUML v0.2.0
2

%HUML v0.2.0
4

%HUML v0.2.0
6

%HUML v0.2.0
8

%HUML v0.2.0
10
```

### Select

Filter values with `select(condition)`:

```bash
$ echo '[1, 2, 3, 4, 5]' | hq '.[] | select(. > 2)'
%HUML v0.2.0
3

%HUML v0.2.0
4

%HUML v0.2.0
5
```

```bash
$ echo '[{"name": "Alice", "age": 30}, {"name": "Bob", "age": 20}]' | hq '.[] | select(.age > 25) | .name'
%HUML v0.2.0
"Alice"
```

## Operators

### Arithmetic

```bash
$ hq -n '2 + 3'
%HUML v0.2.0
5
```

```bash
$ hq -n '10 - 4'
%HUML v0.2.0
6
```

```bash
$ hq -n '6 * 7'
%HUML v0.2.0
42
```

```bash
$ hq -n '20 / 4'
%HUML v0.2.0
5
```

```bash
$ hq -n '17 % 5'
%HUML v0.2.0
2
```

```bash
$ hq -n '2 + 3 * 4'
%HUML v0.2.0
14
```

```bash
$ hq -n '(2 + 3) * 4'
%HUML v0.2.0
20
```

### Comparison

```bash
$ hq -n '5 > 3'
%HUML v0.2.0
true
```

```bash
$ hq -n '5 < 3'
%HUML v0.2.0
false
```

```bash
$ hq -n '5 == 5'
%HUML v0.2.0
true
```

```bash
$ hq -n '5 != 3'
%HUML v0.2.0
true
```

```bash
$ hq -n '5 >= 5'
%HUML v0.2.0
true
```

```bash
$ hq -n '5 <= 4'
%HUML v0.2.0
false
```

### Boolean

```bash
$ hq -n 'true and false'
%HUML v0.2.0
false
```

```bash
$ hq -n 'true or false'
%HUML v0.2.0
true
```

```bash
$ hq -n 'true | not'
%HUML v0.2.0
false
```

```bash
$ hq -n 'null | not'
%HUML v0.2.0
true
```

## Built-in Functions

### Type and Length

```bash
$ echo '"hello"' | hq 'type'
%HUML v0.2.0
"string"
```

```bash
$ echo '[1, 2, 3]' | hq 'type'
%HUML v0.2.0
"array"
```

```bash
$ echo '{"a": 1}' | hq 'type'
%HUML v0.2.0
"object"
```

```bash
$ echo '[1, 2, 3, 4, 5]' | hq 'length'
%HUML v0.2.0
5
```

```bash
$ echo '"hello world"' | hq 'length'
%HUML v0.2.0
11
```

### Keys and Values

```bash
$ echo '{"name": "Alice", "age": 30}' | hq 'keys'
%HUML v0.2.0
- "age"
- "name"
```

### Array Functions

```bash
$ echo '[3, 1, 4, 1, 5, 9, 2, 6]' | hq 'sort'
%HUML v0.2.0
- 1
- 1
- 2
- 3
- 4
- 5
- 6
- 9
```

```bash
$ echo '[1, 2, 2, 3, 3, 3, 4]' | hq 'unique'
%HUML v0.2.0
- 1
- 2
- 3
- 4
```

```bash
$ echo '[1, 2, 3, 4, 5]' | hq 'reverse'
%HUML v0.2.0
- 5
- 4
- 3
- 2
- 1
```

```bash
$ echo '[1, 2, 3, 4, 5]' | hq 'first'
%HUML v0.2.0
1
```

```bash
$ echo '[1, 2, 3, 4, 5]' | hq 'last'
%HUML v0.2.0
5
```

### Add

```bash
$ echo '[1, 2, 3, 4, 5]' | hq 'add'
%HUML v0.2.0
15
```

```bash
$ echo '[[1, 2], [3, 4], [5]]' | hq 'add'
%HUML v0.2.0
- 1
- 2
- 3
- 4
- 5
```

```bash
$ echo '["hello", " ", "world"]' | hq 'add'
%HUML v0.2.0
"hello world"
```

### Map

```bash
$ echo '[1, 2, 3]' | hq 'map(. * 10)'
%HUML v0.2.0
- 10
- 20
- 30
```

```bash
$ echo '[1, 2, 3, 4, 5]' | hq 'map(. * . )'
%HUML v0.2.0
- 1
- 4
- 9
- 16
- 25
```

### String Functions

```bash
$ echo '"hello world"' | hq 'ascii_upcase'
%HUML v0.2.0
"HELLO WORLD"
```

```bash
$ echo '"HELLO WORLD"' | hq 'ascii_downcase'
%HUML v0.2.0
"hello world"
```

```bash
$ echo '"hello,world,foo,bar"' | hq 'split(",")'
%HUML v0.2.0
- "hello"
- "world"
- "foo"
- "bar"
```

```bash
$ echo '["hello", "world"]' | hq 'join(" ")'
%HUML v0.2.0
"hello world"
```

```bash
$ echo '"hello world"' | hq 'startswith("hello")'
%HUML v0.2.0
true
```

```bash
$ echo '"hello world"' | hq 'endswith("world")'
%HUML v0.2.0
true
```

## Variables and Binding

### Simple Variable Binding

Bind values to variables with `as $var`:

```bash
$ echo '{"x": 10, "y": 20}' | hq '.x as $a | .y as $b | $a + $b'
%HUML v0.2.0
30
```

```bash
$ echo '{"items": [1, 2, 3], "multiplier": 10}' | hq '.multiplier as $m | [.items[] | . * $m]'
%HUML v0.2.0
- 10
- 20
- 30
```

### Destructuring Bind

Extract multiple fields at once with destructuring:

```bash
$ echo '{"point": {"x": 10, "y": 20}}' | hq '.point as {x: $x, y: $y} | $x + $y'
%HUML v0.2.0
30
```

```bash
$ echo '{"person": {"name": "Alice", "age": 30}}' | hq '.person as {name: $n, age: $a} | "\($n) is \($a) years old"'
%HUML v0.2.0
"Alice is 30 years old"
```

## Reduce

Reduce iterates over values, accumulating a result:

```bash
$ echo '[1, 2, 3, 4, 5]' | hq 'reduce .[] as $x (0; . + $x)'
%HUML v0.2.0
15
```

```bash
$ echo '[1, 2, 3, 4, 5]' | hq 'reduce .[] as $x (1; . * $x)'
%HUML v0.2.0
120
```

### Building Objects with Reduce

```bash
$ echo '[{"key": "a", "val": 1}, {"key": "b", "val": 2}]' | hq 'reduce .[] as $i ({}; .[$i.key] = $i.val)'
%HUML v0.2.0
a: 1
b: 2
```

## Dynamic Index Access

Access fields dynamically using `.[$var]`:

```bash
$ echo '{"a": 1, "b": 2, "field": "a"}' | hq '.field as $f | .[$f]'
%HUML v0.2.0
1
```

## Conditionals

### If-Then-Else

```bash
$ echo '5' | hq 'if . > 3 then "big" else "small" end'
%HUML v0.2.0
"big"
```

```bash
$ echo '[1, 5, 3, 8, 2]' | hq '[.[] | if . > 4 then "big" else "small" end]'
%HUML v0.2.0
- "small"
- "big"
- "small"
- "big"
- "small"
```

## Error Handling

### Try-Catch

```bash
$ echo '{}' | hq 'try .foo.bar.baz catch "not found"'
%HUML v0.2.0
null
```

```bash
$ echo '5' | hq 'try (1 / 0) catch "division error"'
%HUML v0.2.0
"division error"
```

### Optional Operator

The `?` operator suppresses errors:

```bash
$ echo '[{"a": 1}, {"b": 2}, {"a": 3}]' | hq '[.[] | .a?]'
%HUML v0.2.0
- 1
- 3
```

### Default Values

Use `//` to provide default values for null or false:

```bash
$ echo 'null' | hq '. // "default"'
%HUML v0.2.0
"default"
```

```bash
$ echo '{"name": null}' | hq '.name // "anonymous"'
%HUML v0.2.0
"anonymous"
```

## String Interpolation

Embed expressions in strings with `\(expr)`:

```bash
$ echo '{"name": "World"}' | hq '"Hello, \(.name)!"'
%HUML v0.2.0
"Hello, World!"
```

```bash
$ echo '{"a": 10, "b": 20}' | hq '"\(.a) + \(.b) = \(.a + .b)"'
%HUML v0.2.0
"10 + 20 = 30"
```

## Regex

### Test

```bash
$ echo '"test@example.com"' | hq 'test("@")'
%HUML v0.2.0
true
```

```bash
$ echo '"hello123"' | hq 'test("[0-9]+")'
%HUML v0.2.0
true
```

### Match

```bash
$ echo '"test@example.com"' | hq 'match("(.+)@(.+)") | .captures[].string'
%HUML v0.2.0
"test"

%HUML v0.2.0
"example.com"
```

### Substitution

```bash
$ echo '"hello world"' | hq 'sub("world"; "there")'
%HUML v0.2.0
"hello there"
```

```bash
$ echo '"hello world world"' | hq 'gsub("world"; "planet")'
%HUML v0.2.0
"hello planet planet"
```

## Recursive Descent

The `..` operator recursively descends into all values:

```bash
$ echo '{"a": {"b": {"c": 1}}, "d": 2}' | hq '[.. | numbers]'
%HUML v0.2.0
- 1
- 2
```

```bash
$ echo '{"users": [{"name": "Alice"}, {"name": "Bob"}]}' | hq '[.. | .name? // empty]'
%HUML v0.2.0
- "Alice"
- "Bob"
```

## Path Operations

### Get Paths

```bash
$ echo '{"a": 1, "b": {"c": 2}}' | hq '[paths]'
%HUML v0.2.0
- ::
  - "a"
- ::
  - "b"
- ::
  - "b"
  - "c"
```

```bash
$ echo '{"a": 1, "b": {"c": 2}}' | hq '[paths(scalars)]'
%HUML v0.2.0
- ::
  - "a"
- ::
  - "b"
  - "c"
```

### Get/Set Path

```bash
$ echo '{"a": {"b": 1}}' | hq 'getpath(["a", "b"])'
%HUML v0.2.0
1
```

```bash
$ echo '{"a": 1}' | hq 'setpath(["b", "c"]; 2)'
%HUML v0.2.0
a: 1
b::
  c: 2
```

## Assignment Operators

### Simple Assignment

```bash
$ echo '{"a": 1}' | hq '.b = 2'
%HUML v0.2.0
a: 1
b: 2
```

```bash
$ echo '{"a": 1}' | hq '.a = 10'
%HUML v0.2.0
a: 10
```

### Update Assignment

```bash
$ echo '{"a": 1}' | hq '.a |= . + 1'
%HUML v0.2.0
a: 2
```

```bash
$ echo '[1, 2, 3]' | hq '.[] |= . * 2'
%HUML v0.2.0
- 2
- 4
- 6
```

### Arithmetic Assignment

```bash
$ echo '{"count": 5}' | hq '.count += 1'
%HUML v0.2.0
count: 6
```

```bash
$ echo '{"count": 5}' | hq '.count -= 2'
%HUML v0.2.0
count: 3
```

```bash
$ echo '{"count": 5}' | hq '.count *= 3'
%HUML v0.2.0
count: 15
```

### Delete

```bash
$ echo '{"a": 1, "b": 2, "c": 3}' | hq 'del(.b)'
%HUML v0.2.0
a: 1
c: 3
```

## Object Transforms

### to_entries / from_entries

```bash
$ echo '{"a": 1, "b": 2}' | hq 'to_entries'
%HUML v0.2.0
- ::
  key: "a"
  value: 1
- ::
  key: "b"
  value: 2
```

```bash
$ echo '[{"key": "a", "value": 1}, {"key": "b", "value": 2}]' | hq 'from_entries'
%HUML v0.2.0
a: 1
b: 2
```

### with_entries

```bash
$ echo '{"a": 1, "b": 2}' | hq 'with_entries(.value += 10)'
%HUML v0.2.0
a: 11
b: 12
```

```bash
$ echo '{"foo": 1, "bar": 2}' | hq 'with_entries(.key = "prefix_" + .key)'
%HUML v0.2.0
prefix_bar: 2
prefix_foo: 1
```

## Output Formats

### HUML (default)

```bash
$ echo '{"users": [{"name": "Alice"}, {"name": "Bob"}]}' | hq '.'
%HUML v0.2.0
users::
  - ::
    name: "Alice"
  - ::
    name: "Bob"
```

### JSON

```bash
$ echo '{"name": "Alice", "age": 30}' | hq -o json '.'
{
  "age": 30,
  "name": "Alice"
}
```

### Compact JSON

```bash
$ echo '{"name": "Alice", "age": 30}' | hq -o json -c '.'
{"age":30,"name":"Alice"}
```

### YAML

```bash
$ echo '{"name": "Alice", "age": 30}' | hq -o yaml '.'
age: 30
name: Alice
```

### Raw Output

Use `-r` to output strings without quotes:

```bash
$ echo '{"name": "Alice"}' | hq -r '.name'
Alice
```

## Real-World Examples

### Extract User Names

```bash
$ echo '{"users": [{"name": "Alice", "role": "admin"}, {"name": "Bob", "role": "user"}]}' | hq '.users[].name'
%HUML v0.2.0
"Alice"

%HUML v0.2.0
"Bob"
```

### Filter Active Users

```bash
$ echo '[{"name": "Alice", "active": true}, {"name": "Bob", "active": false}, {"name": "Carol", "active": true}]' | hq '.[] | select(.active) | .name'
%HUML v0.2.0
"Alice"

%HUML v0.2.0
"Carol"
```

### Transform Data

```bash
$ echo '{"firstName": "Alice", "lastName": "Smith"}' | hq '{name: .firstName, surname: .lastName}'
%HUML v0.2.0
name: "Alice"
surname: "Smith"
```

### Calculate Statistics

```bash
$ echo '[10, 20, 30, 40, 50]' | hq 'add'
%HUML v0.2.0
150
```

```bash
$ echo '[10, 20, 30, 40, 50]' | hq 'length'
%HUML v0.2.0
5
```

### Process Config Files

```bash
# Read a HUML config and extract values
cat config.huml | hq '.database.host'

# Convert JSON config to HUML
cat config.json | hq '.' > config.huml

# Convert HUML to JSON
cat config.huml | hq -o json '.' > config.json
```

---

*Generated by `scripts/generate_walkthrough.sh` on 2026-01-21 22:59:53 UTC*
